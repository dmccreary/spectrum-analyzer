
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Create a sound spectrum analyzer using a Raspberry Pi Pico 2 and a OLED display.">
      
      
        <meta name="author" content="Dan McCreary">
      
      
        <link rel="canonical" href="https://dmccreary.github.io/spectrum-analyzer/lessons/06-peak-frequency/">
      
      
        <link rel="prev" href="../05-frequency-shift/">
      
      
        <link rel="next" href="../07-speedups/">
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.45">
    
    
      
        <title>Peak Frequency - Spectrum Analyzer</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Peak Frequency - Spectrum Analyzer" >
      
        <meta  property="og:description"  content="Create a sound spectrum analyzer using a Raspberry Pi Pico 2 and a OLED display." >
      
        <meta  property="og:image"  content="https://dmccreary.github.io/spectrum-analyzer/assets/images/social/lessons/06-peak-frequency.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://dmccreary.github.io/spectrum-analyzer/lessons/06-peak-frequency/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Peak Frequency - Spectrum Analyzer" >
      
        <meta  name="twitter:description"  content="Create a sound spectrum analyzer using a Raspberry Pi Pico 2 and a OLED display." >
      
        <meta  name="twitter:image"  content="https://dmccreary.github.io/spectrum-analyzer/assets/images/social/lessons/06-peak-frequency.png" >
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="navy" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#peak-frequency" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Spectrum Analyzer" class="md-header__button md-logo" aria-label="Spectrum Analyzer" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spectrum Analyzer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Peak Frequency
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dmccreary/spectrum-analyzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub Repo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spectrum Analyzer" class="md-nav__button md-logo" aria-label="Spectrum Analyzer" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Spectrum Analyzer
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dmccreary/spectrum-analyzer" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub Repo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Research
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course-description/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Course Description
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/desktop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desktop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../setup/connections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connections
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lessons
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Lessons
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-test-incoming-sound/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test Sound
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-display-scroll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Display Scroll
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-optimizing-fft-speed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-frequency-shift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frequency Window
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Peak Frequency
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Peak Frequency
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#full-program" class="md-nav__link">
    <span class="md-ellipsis">
      Full Program
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-speedups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Further Speedups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-adding-timers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adding Timers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-assembler-function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assembler FFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-future-improvements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Future Work
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../50-dsp-instructions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DSP Instructions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../30-fft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FFT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../31-fft-butterfly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FFT Butterfly
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MicroSims
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            MicroSims
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sims/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sims/base-and-treble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Base and Treble
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sims/tone-generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tone Generator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sims/waveform-types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Waveform Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sims/fft-butterfly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FFT Butterfly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sims/templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../project-ideas.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Ideas
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../feedback/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Feedback
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../how-we-built-this-site/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How We Built This Site
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#full-program" class="md-nav__link">
    <span class="md-ellipsis">
      Full Program
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="peak-frequency">Peak Frequency</h1>
<div class="admonition prompt">
<p class="admonition-title">Prompt</p>
<p>Please display the frequency that has the highest value on the upper left.  Don't display the "Hz", just the number.</p>
</div>
<p>I'll modify the display to show the frequency with the highest value in the upper left instead of 0Hz, and remove the "Hz" from both labels to keep them clean and simple.</p>
<p>Optimized FFT Implementation for MicroPython</p>
<p>I've updated the display to show the peak frequency in the upper left corner instead of 0Hz, and I've removed the "Hz" label from both numbers as requested.</p>
<p>Here's what the new code does:</p>
<ol>
<li><strong>Finds the peak frequency:</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Find the frequency bin with the highest magnitude</span>
<span class="n">max_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_val</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_freq_focus</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">:</span>
        <span class="n">max_val</span> <span class="o">=</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">max_idx</span> <span class="o">=</span> <span class="n">i</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>Calculates the actual frequency in Hz:</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Calculate the peak frequency in Hz</span>
<span class="n">peak_freq</span> <span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">max_idx</span> <span class="o">*</span> <span class="n">bin_freq_width</span><span class="p">)</span><span class="err">`</span>
</code></pre></div></td></tr></table></div>
<h2 id="full-program">Full Program</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Sound Spectrum Analyzer with FFT - Optimized for MicroPython</span>
<span class="c1"># Combines INMP441 I2S microphone with SSD1306 OLED display and performs FFT</span>
<span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">I2S</span><span class="p">,</span> <span class="n">Pin</span><span class="p">,</span> <span class="n">SPI</span>
<span class="kn">import</span> <span class="nn">ssd1306</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">array</span>

<span class="c1"># OLED Display configuration</span>
<span class="n">SCL</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># SPI Clock</span>
<span class="n">SDA</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># SPI Data</span>
<span class="n">RES</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Reset</span>
<span class="n">DC</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>   <span class="c1"># Data/Command</span>
<span class="n">CS</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>   <span class="c1"># Chip Select</span>

<span class="c1"># Initialize SPI and OLED</span>
<span class="n">spi</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sck</span><span class="o">=</span><span class="n">SCL</span><span class="p">,</span> <span class="n">mosi</span><span class="o">=</span><span class="n">SDA</span><span class="p">)</span>
<span class="n">oled</span> <span class="o">=</span> <span class="n">ssd1306</span><span class="o">.</span><span class="n">SSD1306_SPI</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">spi</span><span class="p">,</span> <span class="n">DC</span><span class="p">,</span> <span class="n">RES</span><span class="p">,</span> <span class="n">CS</span><span class="p">)</span>

<span class="c1"># I2S Microphone configuration</span>
<span class="n">SCK_PIN</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Serial Clock</span>
<span class="n">WS_PIN</span> <span class="o">=</span> <span class="mi">11</span>   <span class="c1"># Word Select</span>
<span class="n">SD_PIN</span> <span class="o">=</span> <span class="mi">12</span>   <span class="c1"># Serial Data</span>

<span class="c1"># I2S configuration parameters</span>
<span class="n">I2S_ID</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">SAMPLE_SIZE_IN_BITS</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">FORMAT</span> <span class="o">=</span> <span class="n">I2S</span><span class="o">.</span><span class="n">MONO</span>
<span class="n">SAMPLE_RATE</span> <span class="o">=</span> <span class="mi">16000</span>
<span class="n">BUFFER_LENGTH_IN_BYTES</span> <span class="o">=</span> <span class="mi">40000</span>

<span class="c1"># Initialize I2S for microphone</span>
<span class="n">audio_in</span> <span class="o">=</span> <span class="n">I2S</span><span class="p">(</span>
    <span class="n">I2S_ID</span><span class="p">,</span>
    <span class="n">sck</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="n">SCK_PIN</span><span class="p">),</span>
    <span class="n">ws</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="n">WS_PIN</span><span class="p">),</span>
    <span class="n">sd</span><span class="o">=</span><span class="n">Pin</span><span class="p">(</span><span class="n">SD_PIN</span><span class="p">),</span>
    <span class="n">mode</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">RX</span><span class="p">,</span>
    <span class="n">bits</span><span class="o">=</span><span class="n">SAMPLE_SIZE_IN_BITS</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">FORMAT</span><span class="p">,</span>
    <span class="n">rate</span><span class="o">=</span><span class="n">SAMPLE_RATE</span><span class="p">,</span>
    <span class="n">ibuf</span><span class="o">=</span><span class="n">BUFFER_LENGTH_IN_BYTES</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># FFT size (must be a power of 2)</span>
<span class="n">FFT_SIZE</span> <span class="o">=</span> <span class="mi">512</span>

<span class="c1"># Precompute the Hanning window coefficients</span>
<span class="n">hanning_window</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">FFT_SIZE</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FFT_SIZE</span><span class="p">):</span>
    <span class="n">hanning_window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

<span class="c1"># Precompute bit-reversal table - MicroPython compatible version</span>
<span class="k">def</span> <span class="nf">bit_reverse</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">bits</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bits</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">bit_reverse_table</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">FFT_SIZE</span><span class="p">)</span>
<span class="n">bits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">FFT_SIZE</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FFT_SIZE</span><span class="p">):</span>
    <span class="n">bit_reverse_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit_reverse</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">bits</span><span class="p">)</span>

<span class="c1"># Precompute twiddle factors (complex exponentials)</span>
<span class="n">twiddle_factors_real</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">twiddle_factors_imag</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">FFT_SIZE</span>
    <span class="n">twiddle_factors_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">twiddle_factors_imag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">capture_audio_samples</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Capture audio samples for FFT processing&quot;&quot;&quot;</span>
    <span class="c1"># For 32-bit samples, we need 4 bytes per sample</span>
    <span class="n">NUM_SAMPLE_BYTES</span> <span class="o">=</span> <span class="n">FFT_SIZE</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="c1"># Raw samples will be stored in this buffer (signed 32-bit integers)</span>
    <span class="n">samples_raw</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">NUM_SAMPLE_BYTES</span><span class="p">)</span>

    <span class="c1"># Read samples from I2S microphone</span>
    <span class="n">num_bytes_read</span> <span class="o">=</span> <span class="n">audio_in</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">samples_raw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_bytes_read</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Process raw samples</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">i&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_bytes_read</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">samples_raw</span><span class="p">[:</span><span class="n">num_bytes_read</span><span class="p">])</span>

    <span class="c1"># Convert to float array and apply windowing function</span>
    <span class="c1"># Reuse the same arrays to avoid memory allocation</span>
    <span class="n">real</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
    <span class="n">imag</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="p">)):</span>
        <span class="c1"># Shift right by 8 bits for INMP441 and apply window</span>
        <span class="n">real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">hanning_window</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">imag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Imaginary part is zero for real input</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">iterative_fft</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute FFT in-place using an iterative algorithm&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">real</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">imag</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">n</span> <span class="o">==</span> <span class="n">FFT_SIZE</span><span class="p">,</span> <span class="s2">&quot;FFT size must match precomputed tables&quot;</span>

    <span class="c1"># Bit-reverse reordering</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">bit_reverse_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">real</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">real</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">real</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">imag</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">imag</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">imag</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">imag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Cooley-Tukey iterative FFT</span>
    <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">stage</span>  <span class="c1"># Distance between butterflies</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m</span> <span class="o">//</span> <span class="mi">2</span>     <span class="c1"># Distance between butterfly pairs</span>

        <span class="c1"># Process each group of butterflies</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="c1"># Process each butterfly pair</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m2</span><span class="p">):</span>
                <span class="c1"># Get twiddle factor</span>
                <span class="n">twiddle_idx</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">wr</span> <span class="o">=</span> <span class="n">twiddle_factors_real</span><span class="p">[</span><span class="n">twiddle_idx</span><span class="p">]</span>
                <span class="n">wi</span> <span class="o">=</span> <span class="n">twiddle_factors_imag</span><span class="p">[</span><span class="n">twiddle_idx</span><span class="p">]</span>

                <span class="c1"># Get indices for butterfly operation</span>
                <span class="n">idx1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx1</span> <span class="o">+</span> <span class="n">m2</span>

                <span class="c1"># Calculate butterfly</span>
                <span class="n">tr</span> <span class="o">=</span> <span class="n">real</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">wr</span> <span class="o">-</span> <span class="n">imag</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">wi</span>
                <span class="n">ti</span> <span class="o">=</span> <span class="n">real</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">wi</span> <span class="o">+</span> <span class="n">imag</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">*</span> <span class="n">wr</span>

                <span class="c1"># Store results</span>
                <span class="n">real</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="n">real</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tr</span>
                <span class="n">imag</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="n">imag</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ti</span>
                <span class="n">real</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">=</span> <span class="n">real</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tr</span>
                <span class="n">imag</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">=</span> <span class="n">imag</span><span class="p">[</span><span class="n">idx1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ti</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">calculate_magnitudes</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate magnitude spectrum from complex FFT result&quot;&quot;&quot;</span>
    <span class="c1"># Only need the first half due to symmetry for real input</span>
    <span class="n">mags</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">))</span>

    <span class="c1"># Use a fast approximation for magnitude calculation</span>
    <span class="c1"># |z| ≈ max(|Re(z)|, |Im(z)|) + 0.4 * min(|Re(z)|, |Im(z)|)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">re_abs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">real</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">im_abs</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">imag</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">re_abs</span> <span class="o">&gt;</span> <span class="n">im_abs</span><span class="p">:</span>
            <span class="n">mags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re_abs</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">im_abs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mags</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">im_abs</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">re_abs</span>

    <span class="k">return</span> <span class="n">mags</span>

<span class="k">def</span> <span class="nf">draw_spectrum</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw the frequency spectrum on the OLED display with focus on lower frequencies&quot;&quot;&quot;</span>
    <span class="c1"># Clear the display</span>
    <span class="n">oled</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Number of frequency bins to display</span>
    <span class="n">num_bins</span> <span class="o">=</span> <span class="mi">64</span>

    <span class="c1"># Focus on lower frequencies by only taking the first third of the spectrum</span>
    <span class="c1"># This will make whistling frequencies more visible across the display</span>
    <span class="n">lower_freq_focus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span>

    <span class="c1"># Calculate the frequency range being displayed</span>
    <span class="c1"># Nyquist frequency is half the sample rate</span>
    <span class="n">nyquist_freq</span> <span class="o">=</span> <span class="n">SAMPLE_RATE</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># Each bin represents nyquist_freq/FFT_SIZE Hz</span>
    <span class="n">bin_freq_width</span> <span class="o">=</span> <span class="n">nyquist_freq</span> <span class="o">/</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate frequency range start and end</span>
    <span class="n">freq_start</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Hz</span>
    <span class="n">freq_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_freq_width</span> <span class="o">*</span> <span class="n">lower_freq_focus</span><span class="p">)</span>  <span class="c1"># Hz</span>

    <span class="c1"># Combine frequency bins to fit display (use precomputed indexes)</span>
    <span class="n">display_bins</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_bins</span><span class="p">)</span>
    <span class="n">bin_width</span> <span class="o">=</span> <span class="n">lower_freq_focus</span> <span class="o">//</span> <span class="n">num_bins</span>

    <span class="c1"># Simple averaging of bins, focusing on lower frequencies</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bins</span><span class="p">):</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bin_width</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_width</span><span class="p">,</span> <span class="n">lower_freq_focus</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_idx</span> <span class="o">&gt;=</span> <span class="n">lower_freq_focus</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># Fast averaging</span>
        <span class="n">bin_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">):</span>
            <span class="n">bin_sum</span> <span class="o">+=</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">display_bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_sum</span> <span class="o">/</span> <span class="p">(</span><span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span> <span class="k">if</span> <span class="n">end_idx</span> <span class="o">&gt;</span> <span class="n">start_idx</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Find maximum value for scaling (avoid division by zero)</span>
    <span class="n">max_magnitude</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">mag</span> <span class="ow">in</span> <span class="n">display_bins</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mag</span> <span class="o">&gt;</span> <span class="n">max_magnitude</span><span class="p">:</span>
            <span class="n">max_magnitude</span> <span class="o">=</span> <span class="n">mag</span>

    <span class="c1"># Reserve top row for frequency labels</span>
    <span class="n">top_margin</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="c1"># Use display height minus top margin</span>
    <span class="n">display_height</span> <span class="o">=</span> <span class="mi">54</span>  <span class="c1"># 64 - top margin - 2</span>
    <span class="n">baseline</span> <span class="o">=</span> <span class="mi">63</span>        <span class="c1"># Start from the bottom of the screen</span>
    <span class="n">scaling_factor</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Adjust scaling to distribute bars</span>

    <span class="c1"># Find the frequency bin with the highest magnitude</span>
    <span class="n">max_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lower_freq_focus</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">)</span> <span class="ow">and</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">:</span>
            <span class="n">max_val</span> <span class="o">=</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">max_idx</span> <span class="o">=</span> <span class="n">i</span>

    <span class="c1"># Calculate the peak frequency in Hz</span>
    <span class="n">peak_freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_idx</span> <span class="o">*</span> <span class="n">bin_freq_width</span><span class="p">)</span>

    <span class="c1"># Display peak frequency on the left and max range on the right</span>
    <span class="n">oled</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">peak_freq</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">end_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">freq_end</span><span class="p">)</span>
    <span class="c1"># Position end frequency text right-aligned</span>
    <span class="n">end_x</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">end_text</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># Each character is ~8 pixels wide</span>
    <span class="n">oled</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">end_text</span><span class="p">,</span> <span class="n">end_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Draw the spectrum - each bin takes 2 pixels width</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">display_bins</span><span class="p">)):</span>
        <span class="c1"># Apply sqrt scaling for more balanced distribution</span>
        <span class="n">normalized</span> <span class="o">=</span> <span class="n">display_bins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_magnitude</span>
        <span class="c1"># Use math.sqrt since we can&#39;t avoid it in MicroPython</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normalized</span><span class="p">)</span> <span class="o">*</span> <span class="n">display_height</span> <span class="o">*</span> <span class="n">scaling_factor</span><span class="p">)</span>

        <span class="c1"># Draw vertical bar</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># Each bar is 2 pixels wide</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">baseline</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="n">top_margin</span><span class="p">:</span>  <span class="c1"># Ensure we don&#39;t write over the frequency text</span>
                <span class="n">oled</span><span class="o">.</span><span class="n">pixel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">oled</span><span class="o">.</span><span class="n">pixel</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Make bars 2 pixels wide</span>

    <span class="c1"># Draw baseline</span>
    <span class="n">oled</span><span class="o">.</span><span class="n">hline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Update the display</span>
    <span class="n">oled</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimized Sound Spectrum Analyzer&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Press Ctrl+C to stop&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate and print frequency range information</span>
    <span class="n">nyquist_freq</span> <span class="o">=</span> <span class="n">SAMPLE_RATE</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">bin_freq_width</span> <span class="o">=</span> <span class="n">nyquist_freq</span> <span class="o">/</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">lower_freq_focus</span> <span class="o">=</span> <span class="p">(</span><span class="n">FFT_SIZE</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">3</span>
    <span class="n">max_freq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bin_freq_width</span> <span class="o">*</span> <span class="n">lower_freq_focus</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequency resolution: </span><span class="si">{:.2f}</span><span class="s2"> Hz per bin&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bin_freq_width</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Display frequency range: 0 Hz to </span><span class="si">{}</span><span class="s2"> Hz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_freq</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FFT size: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FFT_SIZE</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sample rate: </span><span class="si">{}</span><span class="s2"> Hz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SAMPLE_RATE</span><span class="p">))</span>

    <span class="c1"># Allocate arrays once for reuse</span>
    <span class="n">real_buffer</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">FFT_SIZE</span><span class="p">)</span>
    <span class="n">imag_buffer</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">FFT_SIZE</span><span class="p">)</span>

    <span class="c1"># Main processing loop</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Capture audio samples</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">capture_audio_samples</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">samples</span><span class="p">:</span>
            <span class="c1"># Get real and imaginary arrays</span>
            <span class="n">fft_real</span><span class="p">,</span> <span class="n">fft_imag</span> <span class="o">=</span> <span class="n">samples</span>

            <span class="c1"># Compute FFT in-place</span>
            <span class="n">iterative_fft</span><span class="p">(</span><span class="n">fft_real</span><span class="p">,</span> <span class="n">fft_imag</span><span class="p">)</span>

            <span class="c1"># Calculate magnitude spectrum</span>
            <span class="n">magnitudes</span> <span class="o">=</span> <span class="n">calculate_magnitudes</span><span class="p">(</span><span class="n">fft_real</span><span class="p">,</span> <span class="n">fft_imag</span><span class="p">)</span>

            <span class="c1"># Draw the spectrum</span>
            <span class="n">draw_spectrum</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Monitoring stopped&quot;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="c1"># Clean up</span>
    <span class="n">audio_in</span><span class="o">.</span><span class="n">deinit</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Program terminated&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>Optimized Sound Spectrum Analyzer
Press Ctrl+C to stop
Frequency resolution: 31.25 Hz per bin
Display frequency range: 0 Hz to 2656 Hz
FFT size: 512
Sample rate: 16000 Hz
</code></pre></div></td></tr></table></div>
<p>This enhancement makes the display more informative for your demonstrations. As you whistle, the number on the upper left will update to show the exact frequency of your current pitch, while the number on the right shows the maximum frequency displayed on the screen.</p>
<p>This real-time peak frequency display is particularly useful for tuning instruments or demonstrating precise pitch control during your whistling demonstrations.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.footnote.tooltips"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../js/extra.js"></script>
      
    
  </body>
</html>